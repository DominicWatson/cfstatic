<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Full Useage Guide: CfStatic</title>
		<meta name="description" content="CfStatic, CSS and JavaScript control for CFML applications">
		<meta name="author" content="Dominic Watson">

		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<!-- css -->
		<link rel="stylesheet" type="text/css" href="static/css/lib/normalize.css">
		<link rel="stylesheet" type="text/css" href="static/css/typography.css">
		<link rel="stylesheet" type="text/css" href="static/css/lib/syntax.css">
		<link rel="stylesheet" type="text/css" href="static/css/layout.css">
		<link rel="stylesheet" type="text/css" href="static/css/article.css">
		<link rel="stylesheet" type="text/css" href="static/css/print.css">
	</head>
	<body>
		<div id="container">
			<header>
				<div class="centerizer">
					<h1><a href="/">CfStatic</a></h1>
					<p>CSS and JavaScript control for CFML applications</p>
					<a id="fork-me"   class="no-print" target="_blank" href="https://github.com/dominicwatson/cfstatic" title="Fork me on GitHub">Fork me on GitHub</a>
				</div>
			</header>
			<nav class="no-print">
				<ul class="centerizer">
					<li><a href="index.html">Home</a></li>
					<li><a href="quick-start.html">Quick Start</a></li>
					<li><a href="full-guide.html">Full Guide</a></li>
					<li><a href="downloads.html">Downloads</a></li>
					<li><a href="contributing.html">Contributing</a></li>
				</ul>
			</nav>
			<div id="main" role="main">
				<div class="centerizer">
					<h1>Full Useage Guide</h1>

<ol>
<li><a href="#preparation">Preparing your static files</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#useage">API Useage</a></li>
<li><a href="#less">LESS</a></li>
<li><a href="#coffeescript">CoffeeScript</a></li>
</ol>


<p><a id="preparation"></a></p>

<h2>Preparing your static files</h2>

<p>In order for CfStatic to render static includes in the correct order and satisfy dependencies, it must know how your static files relate to each other. It offers three ways in which to do this:</p>

<ol>
<li><a href="#javadoc">JavaDoc style documentation</a> in each file</li>
<li><a href="#dependency-file">Plain text 'dependencies' file</a></li>
<li>File and folder name ordering</li>
</ol>


<p>All three methods may be used. Dependencies declared in JavaDoc style comments and in the dependencies file will be merged. When there is no dependency information, CfStatic will use the file and folder names for ordering of includes.</p>

<p>The JavaDoc style commenting system also allows you to specify other processing instructions for CfStatic, not available in the dependencies file (see below).</p>

<p><a id="javadoc"></a></p>

<h3>JavaDoc style comments</h3>

<p>JavaDoc comments look like this and must be present at the top of your files for CfStatic to process them:</p>

<div class="highlight"><pre><code class="js"><span class="cm">/**</span>
<span class="cm"> * Note the slash and double star to start the comments. The first paragraph of text</span>
<span class="cm"> * within the comment block is a free-text description (i.e. this text). CfStatic</span>
<span class="cm"> * will ignore this description but it can/should be used to document your code.</span>
<span class="cm"> * Key value pair properties are then defined using the @ symbol:</span>
<span class="cm"> *</span>
<span class="cm"> * @property property value</span>
<span class="cm"> * @property another property value</span>
<span class="cm"> * @anotherproperty yet another property value</span>
<span class="cm"> */</span>
</code></pre>
</div>


<p>CfStatic makes use of the following properties:</p>

<ul>
<li><strong>@depends</strong> used to indicate a file dependency (see below), e.g. <code>@depends /core/jquery.js</code></li>
<li><strong>@minified</strong> used to indicate that a file is already minified (do <code>@minified true</code>), CfStatic will not then re-minify the file</li>
<li><strong>@ie</strong> used to indicate an Internet Explorer restriction for the file, e.g. <code>@ie LTE IE 8</code></li>
<li><strong>@media</strong> for CSS files only, used to indicate the target media for the CSS file, e.g. <code>@media print</code></li>
</ul>


<h3>Documenting dependencies</h3>

<p>Core to the correct running of CfStatic is the use of the @depends property to document dependencies between your files; CfStatic uses this information to ensure all necessary files are included in your page, and in the correct order. Dependencies can be either local or external, e.g. <code>@depends http://someurl.com/somejs.js</code> is an external dependency, <code>@depends /jqueryplugins/tooltip.js</code> is a local dependency.</p>

<p>Local dependencies have a path that starts at the root folder of the type of file you are dealing with. i.e. If your javascript files all live at <code>/webroot/static/js/</code>, and the file <code>/webroot/static/js/plugins/myplugin.js</code> has a dependency on <code>/webroot/static/js/core/jquery.js</code>, that dependency would be written like so: <code>@depends /core/jquery.js</code>.</p>

<h4>Already minified files</h4>

<p>Some of your local files may already have been minified or you may not want certain files to be minified by CfStatic. By setting the <strong>@minified</strong> property to true (i.e. <code>@minified true</code>), CfStatic will <em>not</em> put the file through the minifier. The file will still be renamed and moved to the output directory however.</p>

<h4>Internet Explorer specific includes</h4>

<p>These can be declared using the <strong>@ie</strong> property and static files with this property set will be wrapped in Conditional Comments when output as includes. Examples:</p>

<div class="highlight"><pre><code class="js"><span class="cm">/**</span>
<span class="cm"> * This is my IE 6 only print stylesheet</span>
<span class="cm"> *</span>
<span class="cm"> * @ie IE 6</span>
<span class="cm"> * @media print</span>
<span class="cm"> * @depends /core/layout.css</span>
<span class="cm"> */</span>
</code></pre>
</div>




<div class="highlight"><pre><code class="js"><span class="cm">/**</span>
<span class="cm"> * This is my IE 8 and below stylesheet</span>
<span class="cm"> *</span>
<span class="cm"> * @ie LT IE 8</span>
<span class="cm"> * @depends /core/layout.css</span>
<span class="cm"> */</span>
</code></pre>
</div>


<p>See here for conditional comment reference:</p>

<p><a href="http://msdn.microsoft.com/en-us/library/ms537512(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/ms537512(v=vs.85).aspx</a></p>

<p><a id="dependency-file"></a></p>

<h3>Dependency file</h3>

<p>The dependency file can be used to document dependencies only. This has some advantages over the javadoc style approach:</p>

<ol>
<li>Not having to repeat dependency definitions in every file. For instance, if you want to upgrade jquery, you have only one dependency definition to change</li>
<li>Documenting dependencies between external resources</li>
</ol>


<p>An example javascript dependency file (the syntax is the same for css dependencies):</p>

<div class="highlight"><pre><code class="sh"><span class="c">##</span>
<span class="c"># This file details dependencies between javascript files</span>
<span class="c">#</span>
<span class="c"># Indented files have dependencies on the unindented file(s) above them</span>
<span class="c"># Dependent files marked with (conditional), only depend on the file above</span>
<span class="c"># when it is already included in the request and can be included without</span>
<span class="c"># the dependency.</span>
<span class="c">#</span>

http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js
    http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js
    *.js

http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js
    /folder/some.js
    /core/bootstrap.js
    /ui-pages/*.js

/core/bootstrap.js
    /folder/*.js
    /ui-pages/*.js
    /shared/*.js

/folder/some.js
    /folder/some-more.js

/shared/swfLoader/swfLoader.js
    /folder/some.js

/shared/jqGrid/locales/*.js
    /shared/jqGrid/jqGrid.js <span class="o">(</span>conditional<span class="o">)</span>

/shared/jqGrid/jqGrid.js
    /folder/some-more.js
</code></pre>
</div>


<h3>Configuring CfStatic to use the dependency file</h3>

<p>Use the two configuration options, <code>jsDependencyFile</code> and <code>cssDependencyFile</code> to point CfStatic to your dependency files. The files themselves can be called anything you like. My current preference is for <code>dependency.info</code> placed in the root of both js and css directories - but that's just me. Example:</p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nv">application.cfstatic</span> <span class="o">=</span> <span class="nf">CreateObject</span><span class="p">(</span> <span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;org.cfstatic.CfStatic&#39;</span> <span class="p">).</span><span class="nf">init</span><span class="p">(</span>
        <span class="nv">staticDirectory</span>   <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span><span class="s1">&#39;./static&#39;</span><span class="p">)</span>
      <span class="p">,</span> <span class="nv">staticUrl</span>         <span class="o">=</span> <span class="s2">&quot;/static/&quot;</span>
      <span class="p">,</span> <span class="nv">jsDependencyFile</span>  <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span> <span class="s1">&#39;./static/js/dependency.info&#39;</span> <span class="p">)</span>
      <span class="p">,</span> <span class="nv">cssDependencyFile</span> <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span> <span class="s1">&#39;./static/css/dependency.info&#39;</span> <span class="p">)</span>
    <span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<h3>Syntax of the dependencies file</h3>

<h4>Comments</h4>

<p>Lines beginning with a # are ignored by the parser. Empty lines are also ignored.</p>

<h4>Indentation</h4>

<p>Paths to files that are declared <em>unindented</em> are treated as <em>dependencies</em>. Their <em>dependents</em> are defined by subsequent paths that do have indentation. Only one level of indentation is processed, i.e. all depths of indentation are treated the same. For example:</p>

<div class="highlight"><pre><code class="sh"><span class="c"># core.js is dependent on jquery.js</span>
/core/jquery.js
    /core/core.js

<span class="c"># both tools.js and api.js are dependent on core.js</span>
<span class="c"># note that api.js is not dependent on tools.js because</span>
<span class="c"># only one level of indentation is processed</span>
/core/core.js
    /core/tools.js
      /core/api.js
</code></pre>
</div>


<h4>Wildcard mappings</h4>

<p>Wildcard mappings may be used to declare multiple dependents and dependencies. For example:</p>

<div class="highlight"><pre><code class="sh"><span class="c"># all css and less files depend on reset.less</span>
/core/reset.less
    *.css
    *.less

<span class="c"># all .less files beginning with fubar-</span>
<span class="c"># depend on fubarcore.less</span>
/fubar/fubarcore.less
    /fubar/fubar-*.less

<span class="c"># all files under the fubar folder</span>
<span class="c"># depend on all core files</span>
/core/*.*
    /fubar/*.*
</code></pre>
</div>


<h4>Conditional dependencies</h4>

<p>A conditional dependency is one in which 'resource a' is dependent on 'resource b' <em>only when 'resource b' is included</em>. This means that 'resource a' can be included without 'resource b', but when 'resource b' is included, it will always be rendered before 'resource a'.</p>

<p>To declare a dependant as conditional, you append <code>(conditional)</code> to the file path. For example:</p>

<div class="highlight"><pre><code class="sh">/shared/jqGrid/locales/*.js
    /shared/jqGrid/jqGrid.js <span class="o">(</span>conditional<span class="o">)</span>
</code></pre>
</div>


<p>This is a perfect example of this kind of dependency. <code>jqGrid.js</code> is dependent on <em>a</em> locale file but which one must be determined at request time. Without the <code>(conditional)</code> instruction, all locales would be included on every request. So now, you can include the user's locale at request time and know that it will always be included before jqGrid.js:</p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nf">cfstatic.include</span><span class="p">(</span> <span class="s1">&#39;/js/shared/jqGrid/jqGrid.js&#39;</span> <span class="p">)</span>
            <span class="p">.</span><span class="nf">include</span><span class="p">(</span> <span class="s1">&#39;/js/shared/jqGrid/locales/#session.user.locale#.js&#39;</span> <span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<p><a id="configuration"></a></p>

<h2>Configuration</h2>

<h3>Argument reference</h3>

<p>The CfStatic init() method takes the following arguments. Do not be alarmed at the number of them, only two are mandatory, the rest have sensible defaults:</p>

<pre><code>staticDirectory:     Full path to the directory in which static files
                     reside (e.g. /webroot/static/)

staticUrl:           Url that maps to the static directory (e.g.
                     http://mysite.com/static or /static)

jsDirectory:         Relative path to the directoy in which javascript
                     files reside. Relative to static path. Default is
                     'js'

cssDirectory:        Relative path to the directoy in which css files
                     reside. Relative to static path. Default is 'css'

outputDirectory:     Relative path to the directory in which minified
                     files will be output. Relative to static path.
                     Default is 'min'

minifyMode:          The minify mode. Options are: 'none', 'file',
                     'package' or 'all'. Default is 'package'.
                     downloadExternals:   If set to true, CfMinify will
                     download and minify locally any external
                     dependencies (e.g.
                     http://code.jquery.com/jquery-1.6.1.min,js). Default = false

debugAllowed:        Whether or not debug is allowed. Defaulting to
                     true, even though this may seem like a dev setting.
                     No real extra load is made on the server by a user
                     making use of debug mode and it is useful by default.
                     Default = true.

debugKey:            URL parameter name used to invoke debugging (if
                     enabled). Default = 'debug'

debugPassword:       URL parameter value used to invoke debugging (if
                     enabled). Default = 'true'

forceCompilation:    Whether or not to check for updated files before
                     compiling (true = do not check). Default = false.

checkForUpdates:     Whether or not to attempt recompilation on every
                     request. Default = false

includeAllByDefault: Whether or not to include all static files in a
                     request when the .include() method is never called
                     (default = true) *0.2.2*

embedCssImages:      Either 'none', 'all' or a regular expression to
                     select css images that should be embedded in css
                     files as base64 encoded strings, e.g. '\.gif$' for
                     only gifs or '.*' for all images (default = 'none')
                     *0.3.0*

includePattern:      Regex pattern indicating css and javascript files to
                     be included in CfStatic's processing. Defaults to .*
                     (all) *0.4.0*

excludePattern:      Regex pattern indicating css and javascript files to
                     be excluded from CfStatic's processing. Defaults to
                     blank (exclude none) *0.4.0*

outputCharset:       Character set to use when writing outputted minified
                     files *0.4.0*

javaLoaderScope:     The scope in which instances of JavaLoader libraries
                     for the compilers should be persisted, either
                     'application' or 'server' (default is 'server' to
                     prevent JavaLoader memory leaks). You may need to use
                     'application' in a shared hosting environment *0.4.1*

lessGlobals:         Comma separated list of .LESS files to import when
                     processing all .LESS files. Files will be included in
                     the order of the list *0.4.2*

jsDataVariable       JavaScript variable name that will contain any data
                     passed to the .includeData() method, default is
                     'cfrequest' *0.6.0*

jsDependencyFile     Text file describing the dependencies between
                     javascript files *0.6.0*

cssDependencyFile    Text file describing the dependencies between css
                     files *0.6.0*
</code></pre>

<h3>Static paths</h3>

<p>The minimal setup, ready for production, involves declaring your root static directory and the url that maps to it. This assumes that you have 'js', 'css' and 'min' folders beneath your 'staticDirectory'. For example, consider the following directory structure:</p>

<pre><code>./
../
includes/
    css/
    js/
    min/
Application.cfc
</code></pre>

<p>The minimal configuration might look like this:</p>

<p><strong>Application.cfc</strong></p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nv">application.cfstatic</span> <span class="o">=</span> <span class="nf">CreateObject</span><span class="p">(</span><span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;org.cfstatic.CfStatic&#39;</span><span class="p">).</span><span class="nf">init</span><span class="p">(</span>
          <span class="nv">staticDirectory</span> <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span><span class="s1">&#39;/includes&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="nv">staticUrl</span>       <span class="o">=</span> <span class="s2">&quot;/includes&quot;</span>
    <span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<p>Another example, this time with non-default folder names for the static files, and css and javascript having a folder to themselves in the root:</p>

<pre><code>./
../
styles/
javascript/
compiled/
index.cfm
Application.cfc
</code></pre>

<p>In this case, your configuration might look like:</p>

<p><strong>Application.cfc</strong></p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nv">application.cfstatic</span> <span class="o">=</span> <span class="nf">CreateObject</span><span class="p">(</span><span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;org.cfstatic.CfStatic&#39;</span><span class="p">).</span><span class="nf">init</span><span class="p">(</span>
          <span class="nv">staticDirectory</span> <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="nv">staticUrl</span>       <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
        <span class="p">,</span> <span class="nv">jsDirectory</span>     <span class="o">=</span> <span class="s1">&#39;javascript&#39;</span>
        <span class="p">,</span> <span class="nv">cssDirectory</span>    <span class="o">=</span> <span class="s1">&#39;styles&#39;</span>
        <span class="p">,</span> <span class="nv">outputDirectory</span> <span class="o">=</span> <span class="s1">&#39;compiled&#39;</span>
    <span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<h3>Minify modes</h3>

<p>Minify modes control how CfStatic minifies your files. The options are:</p>

<ul>
<li><strong>None</strong>: no minification (i.e. only use CfStatic for the request inclusion and dependency handling framework )</li>
<li><strong>File</strong>: files are minified but not concatenated in any way</li>
<li><strong>Package</strong> (default): files are minified and concatenated in packages (all files in the same folder are considered a package)</li>
<li><strong>All</strong>: files are minified and concatenated into a single JavaScript file and a single CSS file</li>
</ul>


<p>Use the <em>minifyMode</em> argument to set this behaviour. For a more in-depth look at minify modes, see my blog post here:</p>

<p><a href="http://fusion.dominicwatson.co.uk/2011/09/understanding-the-package-minify-mode-in-cfstatic.html">http://fusion.dominicwatson.co.uk/2011/09/understanding-the-package-minify-mode-in-cfstatic.html</a></p>

<h3>External dependencies</h3>

<p>External dependencies can be declared in your static files with <code>@depends http://www.somsite.com/somefile.js</code>. CfStatic can either download these dependencies for local minification and concatenation, or it can simply output an include to reference the file remotely. This might be a good idea for popular libraries hosted on CDNs such as jQuery. However, if you're creating an intranet application, it may be wise to ensure that all files are served from your own server.</p>

<p>Use the <em>downloadExternals</em> argument to set this behaviour.</p>

<h3>Debug mode</h3>

<p>By default, you can make CfStatic output includes for your source files rather than the minified files, by providing the url parameter, <code>debug=false</code>. You can turn this behaviour off altogether with the <em>debugAllowed</em> argument, or you can set the url parameter name and value with the <em>debugKey</em> and <em>debugPassword</em> parameters.</p>

<h3>Monitoring for updates</h3>

<p>CfStatic can be set up to monitor your static files for changes, recompiling when it finds them. This is really useful for local development though is turned <em>off</em> by default. Use the <em>checkForUpdates</em> argument to set this behaviour.</p>

<p>Also by default, CfStatic will <em>not</em> recompile on instantiation if it finds that there have been no changes to your files. You can change this behaviour, forcing recompiling on instantiation (e.g. on application start), by using the <em>forceCompilation</em> argument.</p>

<p>A combination of the two arguments, e.g. <code>checkForUpdates=true</code> and <code>forceCompilation=true</code>, will force recompiling on every request.</p>

<h3>Including all files by default (from 0.2.2)</h3>

<p>Out of the box, CfStatic will include <em>all</em> your static files if you never use the .include() method to specifically pick files to include (i.e. you just do .renderIncludes()). You can change this behaviour by setting <code>includeAllByDefault</code> to false.</p>

<h3>Embedding CSS Images (from 0.3.0)</h3>

<p>The <code>embedCssImages</code> option allows you to instruct CfStatic to embed CSS images as data URIs in the compiled CSS files (see <a href="http://en.wikipedia.org/wiki/Data_URI_scheme">http://en.wikipedia.org/wiki/Data_URI_scheme</a>).</p>

<p>The default option of '<code>none</code>' performs no image embedding. Passing '<code>all</code>' will instruct CfStatic to embed <em>all</em> CSS images. Finally, you can pass a regular expression to specify which images will be chosen for embedding.</p>

<p>For more information, see the blog post here:</p>

<p><a href="http://fusion.dominicwatson.co.uk/2012/01/cfstatic---embedding-css-images.html">http://fusion.dominicwatson.co.uk/2012/01/cfstatic---embedding-css-images.html</a></p>

<h3>Excluding resources from the engine (from 0.4.0)</h3>

<p>For whatever reason, you may wish to have CfStatic overlook certain CSS, LESS or JavaScript files. From <em>0.4.0</em> there are two arguments that will allow you to do just that, <code>includePattern</code> and <code>excludePattern</code>. By combining these two arguments that both accept regex patterns, you can have full control over what CfStatic will include. For example, you may wish to exclude some Global LESS files:</p>

<pre><code>  includePattern = '.*'
, excludePattern = '.*/lessGlobals/.*'
</code></pre>

<p>Or only include any resources under a <code>raw</code> folder that do not contain an underscore:</p>

<pre><code>  includePattern = '.*/raw/.*'
, excludePattern = '.*_.*'
</code></pre>

<p><a id="useage"></a></p>

<h2>API Useage</h2>

<p>Once you have configured CfStatic and marked up your static files with the appropriate dependency documentation, you arrive at the pleasing point of having very little left to do. The CfStatic API provides 4 methods:</p>

<ol>
<li><strong>init( <em>options</em> )</strong>: used to get an instance of Cfstatic</li>
<li><strong>include( <em>resource</em> )</strong>: used to instruct CfStatic that a particular file or package (folder) is required for this request</li>
<li><strong>includeData( <em>data</em> )</strong>: used to output data to a JavaScript variable when the javascript is rendered</li>
<li><strong>renderIncludes( <em>[type]</em> )</strong>: used to render the CSS or JavaScript includes</li>
</ol>


<p><a id="instance-creating"></a></p>

<h3>Creating an instance of the API for your application</h3>

<p>The API is published in the component, <code>org.cfstatic.CfStatic</code>. An instance should be created using the component's init() method, passing in any <a href="#configuration">configuration</a> arguments for your environment, and stored in a cacheable scope. An example, without using any framework, might look like this:</p>

<p><strong>Application.cfc</strong></p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nv">function</span> <span class="nf">onApplicationStart</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">application.cfstatic</span> <span class="o">=</span> <span class="nf">CreateObject</span><span class="p">(</span><span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;org.cfstatic.CfStatic&#39;</span><span class="p">).</span><span class="nf">init</span><span class="p">(</span>
            <span class="nv">staticDirectory</span> <span class="o">=</span> <span class="nf">ExpandPath</span><span class="p">(</span><span class="s1">&#39;./static&#39;</span><span class="p">)</span>
          <span class="p">,</span> <span class="nv">staticUrl</span>       <span class="o">=</span> <span class="s2">&quot;/static/&quot;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<p>All CfStatic operations can now be performed using this instance, e.g.</p>

<p><strong>MyLayout.cfm</strong></p>

<div class="highlight"><pre><code class="cfm">        ...
        #application.cfstatic.renderIncludes( &#39;css&#39; )#
    <span class="nt">&lt;/head&gt;</span>
</code></pre>
</div>


<h3>Include( <em>required string resource</em> )</h3>

<p>You can use this method to include an entire package or a single file in the request page (a package is a folder of files, not including sub-folders). Paths start at the root static directory, so the following are all valid:</p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="c">// include the layout.css file</span>
    <span class="nf">cfStatic.include</span><span class="p">(</span><span class="s1">&#39;/css/core/layout.css&#39;</span><span class="p">);</span>

    <span class="c">// include the &#39;core&#39; css package (note the trailing slash on the directory name)</span>
    <span class="nf">cfStatic.include</span><span class="p">(</span><span class="s1">&#39;/css/core/&#39;</span><span class="p">);</span>

    <span class="c">// include a bunch of js packages and files, chaining the method call</span>
    <span class="nf">cfStatic.include</span><span class="p">(</span><span class="s1">&#39;/js/core/&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="s1">&#39;/js/core/ie-only/&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="s1">&#39;/js/plugins/timers.js&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="s1">&#39;/js/pagespecific/homepage/&#39;</span><span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<h4>Including non existent packages or files</h4>

<p>If you try to include a package or file that does not exist, no error will be thrown and CfStatic will not render an include for that package or file. This is to allow you to create dynamic includes based on any rules you like. For instance, you might want to try to include page specific css when it is available, something like:</p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
     <span class="c">// where request.pageName is some variable set by your application:</span>
    <span class="nf">cfStatic.include</span><span class="p">(</span><span class="s1">&#39;/css/pageSpecific/#request.pageName#/&#39;</span><span class="p">);</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<p>You can then include page specific css simply by creating a directory of css files with the appropriate name.</p>

<h4>Don't worry about the order</h4>

<p>You can include your static files in any order you like and you can include the same files multiple times; CfStatic will take care of rendering them in the correct order and once each only.</p>

<h3>IncludeData( <em>required struct data</em> )</h3>

<p>You can use the IncludeData method to make CF data available to your JavaScript. The following example illustrates its usage:</p>

<p><strong>someColdFusionFile.cfm</strong></p>

<div class="highlight"><pre><code class="cfm"><span class="nb">&lt;cfscript&gt;</span>
    <span class="nv">data</span>                    <span class="o">=</span> <span class="nf">StructNew</span><span class="p">();</span>
    <span class="nv">data</span><span class="p">[</span><span class="s1">&#39;userColorChoice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">session.user.prefs.colorChoice</span><span class="p">;</span>
    <span class="nv">data</span><span class="p">[</span><span class="s1">&#39;fu&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
    <span class="nv">data.watchMyCase</span>        <span class="o">=</span> <span class="s1">&#39;sensitive isn&#39;</span><span class="nv">t</span> <span class="nv">it</span><span class="err">?&#39;</span><span class="p">;</span>

    <span class="nf">cfStatic.includeData</span><span class="p">(</span> <span class="nv">data</span> <span class="p">)</span>
            <span class="p">.</span><span class="nf">includeData</span><span class="p">(</span> <span class="p">{</span><span class="nv">bar</span><span class="o">=</span><span class="s2">&quot;fu&quot;</span><span class="p">}</span> <span class="p">);</span> <span class="c">// you can chain me too</span>
<span class="nb">&lt;/cfscript&gt;</span>
</code></pre>
</div>


<p><strong>Outputted JavaScript before all includes</strong></p>

<div class="highlight"><pre><code class="js">    <span class="kd">var</span> <span class="nx">cfrequest</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s2">&quot;userColorChoice&quot;</span> <span class="o">:</span> <span class="s2">&quot;#FF99FF&quot;</span>
       <span class="p">,</span> <span class="s2">&quot;fu&quot;</span>              <span class="o">:</span> <span class="s2">&quot;bar&quot;</span>
       <span class="p">,</span> <span class="s2">&quot;WATCHMYCASE&quot;</span>     <span class="o">:</span> <span class="s2">&quot;sensitive isn&#39;t it?&quot;</span>
       <span class="p">,</span> <span class="s2">&quot;BAR&quot;</span>             <span class="o">:</span> <span class="s2">&quot;fu&quot;</span>
    <span class="p">};</span>

    <span class="c1">// you now have access to cfrequest.userColorChoice, etc. from within your javacsript</span>
</code></pre>
</div>


<h4>Beware of case sensitivity</h4>

<p>JavaScript is case sensitive and ColdFusion uppercases all struct keys that are not declared using array notation. Hopefully, the example above illustrates this.</p>

<h3>RenderIncludes( <em>[string type]</em> )</h3>

<p>This method returns the necessary html to include your static files. The type argument is optional and should be set to either 'CSS' or 'JS' when passed. Here are a couple of examples:</p>

<p><strong>ExampleLayout1.cfm</strong></p>

<div class="highlight"><pre><code class="cfm">    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
            ...
            <span class="c">&lt;!-- render all css and js includes (css first) --&gt;</span>
            #cfStatic.renderIncludes()#
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
            ...
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p><strong>ExampleLayout2.cfm</strong></p>

<div class="highlight"><pre><code class="cfm">    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
            ...
            <span class="c">&lt;!-- render css in the head of the page --&gt;</span>
            #cfStatic.renderIncludes(&#39;css&#39;)#
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
            ...
            <span class="c">&lt;!-- render js at the bottom of the page --&gt;</span>
            #cfStatic.renderIncludes(&#39;js&#39;)#
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p>That's it!</p>

<p><a id="less"></a></p>

<h2>LESS</h2>

<h3>CfStatic now supports compiling of <code>.less</code> files!</h3>

<p>If you've not heard of LESS CSS, head on over to <a href="http://lesscss.org/">http://lesscss.org/</a> and fall to your knees in humble awe (and get all coder giddy).</p>

<p>In CfStatic, simply create .less files with LESS css in them in exactly the same way you create .css files for CfStatic. CfStatic will take your .less files and compile them as css, saving the output to <code>yourfile.less.css</code>. It will then minify that compiled css file in accordance with the rules you configure.</p>

<p>Neat eh?</p>

<p><a id="coffeescript"></a></p>

<h2>CoffeeScript</h2>

<p>CfStatic will compile any <code>.coffee</code> files in your JavaScript directories, converting them to JavaScript files with the <code>.coffee.js</code> extension. A couple of things to note:</p>

<h3>Formatting of JavaDoc comments</h3>

<p>JS comments are not valid CoffeeScript. To markup your CoffeeScript files ready for CfStatic, use the following format:</p>

<div class="highlight"><pre><code class="js">    <span class="err">###</span><span class="o">*</span>
    <span class="o">*</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">my</span> <span class="nx">coffeescript</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">its</span> <span class="nx">really</span> <span class="nx">neat</span><span class="p">.</span>
    <span class="o">*</span>
    <span class="o">*</span> <span class="err">@</span><span class="nx">depends</span> <span class="o">/</span><span class="nx">some</span><span class="o">/</span><span class="nx">file</span><span class="p">.</span><span class="nx">coffee</span><span class="p">.</span><span class="nx">js</span>
    <span class="o">*</span>
    <span class="err">###</span>
</code></pre>
</div>


<h3>Bare mode</h3>

<p>By default, CoffeeScript will wrap the compiled <code>.js</code> in an anonymous function call to ensure no leaked variables:</p>

<div class="highlight"><pre><code class="js">    <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// your compiled js here</span>
    <span class="p">})();</span>
</code></pre>
</div>


<p>If you do not want this behaviour, CoffeeScript offers a "bare mode" switch so that the anonymous function wrapper is not included (which they do not recommend). In CfStatic, simply name your CoffeeScript files with the <code>.bare.coffee</code> extension to have them compiled in bare mode. --></p>

				</div>
			</div>
    		<footer>
				<div class="centerizer">
    				<p>&copy; Dominic Watson 2012.</p>
				</div>
    		</footer>
  		</div><!--! end of #container -->
	</body>
</html>
